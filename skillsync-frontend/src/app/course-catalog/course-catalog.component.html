<div class="course-catalog">
  <mat-form-field>
    <input matInput [(ngModel)]="searchTerm" (ngModelChange)="onSearchChange()" placeholder="{{ 'COURSES.SEARCH' | translate }}">
  </mat-form-field>

  <mat-form-field>
    <mat-select [(ngModel)]="levelFilter" (ngModelChange)="onLevelFilterChange()">
      <mat-option [value]="">{{ 'COURSES.ALL_LEVELS' | translate }}</mat-option>
      <mat-option *ngFor="let level of levels" [value]="level">{{ level }}</mat-option>
    </mat-select>
  </mat-form-field>

  <mat-form-field>
    <input matInput type="number" [(ngModel)]="durationFilter" (ngModelChange)="onDurationFilterChange()" placeholder="{{ 'COURSES.MAX_DURATION' | translate }}">
  </mat-form-field>

  <mat-form-field>
    <mat-chip-list #chipList>
      <mat-chip *ngFor="let tag of tagFilter" (removed)="removeTagFilter(tag)">
        {{tag}}
        <mat-icon matChipRemove>cancel</mat-icon>
      </mat-chip>
      <input placeholder="{{ 'COURSES.ADD_TAG' | translate }}"
             [matChipInputFor]="chipList"
             [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
             (matChipInputTokenEnd)="addTagFilter($event)">
    </mat-chip-list>
  </mat-form-field>

  <div *ngIf="!isLoading; else loadingSpinner">
    <mat-card *ngFor="let course of filteredCourses" class="course-card">
      <mat-card-header>
        <mat-card-title>{{ course.title }}</mat-card-title>
        <mat-card-subtitle>{{ course.instructor }}</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <p>{{ course.description }}</p>
        <p>{{ 'COURSES.LEVEL' | translate }}: {{ course.level }}</p>
        <p>{{ 'COURSES.DURATION' | translate }}: {{ course.duration }} {{ 'COURSES.HOURS' | translate }}</p>
        <mat-chip-list>
          <mat-chip *ngFor="let tag of course.tags">{{ tag }}</mat-chip>
        </mat-chip-list>
      </mat-card-content>
      <mat-card-actions>
        <button mat-button (click)="enrollCourse(course._id)">
          {{ course.isEnrolled ? ('COURSES.ENROLLED' | translate) : ('COURSES.ENROLL' | translate) }}
        </button>
        <button mat-button (click)="toggleWishlist(course)">
          {{ 'COURSES.WISHLIST' | translate }}
        </button>
        <app-rating
          [rating]="course.userRating"
          (ratingChange)="onRatingChange(course._id, $event)"
        ></app-rating>
      </mat-card-actions>
    </mat-card>
  </div>

  <ng-template #loadingSpinner>
    <mat-spinner></mat-spinner>
  </ng-template>

  <mat-paginator [length]="totalCourses"
                 [pageSize]="pageSize"
                 [pageSizeOptions]="[5, 10, 25, 100]"
                 (page)="onPageChange($event)">
  </mat-paginator>
</div>
